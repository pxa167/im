---
title: "Prelim CHF Paper"
author: "pxa"
date: "7/29/2019"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = FALSE, results='hide', warning=FALSE, message=FALSE, error=FALSE}
#Load required packages
library(survey)
library(foreign)
library(tidyverse)
library(ggplot2)
library(scales)
library(broom)
# Set options to deal with lonely psu 
options(survey.lonely.psu='adjust');
cb_palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442",
                "#0072B2", "#D55E00", "#CC79A7")
#load data
load("chf_data.RData")

#create survey object
mepsdsgn = svydesign(
  id = ~varpsu, 
  strata = ~varstr, 
  weights = ~perwt16f, 
  data = data, 
  nest = TRUE)  
```
### Introduction
- talk about heart failure in general: definition, classic clinical presentation, prevalence, associated morbidity and mortality, etc. 

- talk about how pharmacology is cornerstone of management; stress importance of beta-blockers, ACE inhibitors / ARBs, and aldosterone antagonist, as they are only agents shown to decrease mortality

- talk about general interest in seeing whether all heart failure patients are on BBs and ACEi/ARBs (as they should be, these drugs are indicated in all classes of heart failure); aldosterone antagonists are indicated in a specific subpopulation of heart failure patients so we don't expect 100% take-up (can mention this "Discussion" under "limitations")

- talk about knowing about the degree of take-up of these medications can help us see whether HF is being managed appropriately at a population level; whether there are certain populations that are more likely to be managed sub-optimally. This knowledge is valuable because we can act upon it?

### Methods

#### Study Design and Population
- i would deal with this

#### Medication Use and Expenditures
- i would deal with this

#### Covariates
- i would deal with this

#### Statistical Analysis
- i would deal with this


### Results

- Overall, 172 MEPS participants were eligible for the study. Demographic characteristics are noted in tabular and graphical form below.(I'll figure out a way to make nicer tables at some point.) 

#### Demographic Tables {.tabset}

##### Gender

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ sex , mepsdsgn)
```

##### Race/Ethnicity

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ racethx , mepsdsgn)
```

##### Insurance Coverage

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ inscov16 , mepsdsgn)
```

##### Income Category

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ povcat16 , mepsdsgn)
```

##### Region

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ region16 , mepsdsgn)
```

####

#### Demographic Graphs {.tabset}

##### Gender

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ sex , mepsdsgn) %>%
  as.data.frame() %>%
  add_column(gender = c("Male", "Female")) %>%
  ggplot(aes(y = mean, x = gender)) + 
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  ylab("Percent") +
  xlab("Gender") +
  ggtitle("Breakdown of Study Population by Gender")

```

##### Race/Ethnicity

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ racethx , mepsdsgn) %>%
  as.data.frame() %>%
  add_column(racethx = levels(data$racethx)) %>%
  ggplot(aes(y = mean, x = racethx)) + 
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  ylab("Percent") +
  xlab("Race/Ethnicity") +
  ggtitle("Breakdown of Study Population by Race/Ethnicity")


```

##### Insurance Coverage

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ inscov16 , mepsdsgn) %>%
  as.data.frame() %>%
  add_column(inscov = levels(data$inscov16)) %>%
  ggplot(aes(y = mean, x = inscov)) + 
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  ylab("Percent") +
  xlab("Type of Insurance Coverage") +
  ggtitle("Breakdown of Study Population by Type of Insurance Coverage")


```

##### Income Category

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ povcat16 , mepsdsgn) %>%
  as.data.frame() %>%
  add_column(povcat = levels(data$povcat16)) %>%
  ggplot(aes(y = mean, x = povcat)) + 
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  ylab("Percent") +
  xlab("Income") +
  ggtitle("Breakdown of Study Population by Type of Income")


```

##### Region

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
svymean(~ region16 , mepsdsgn) %>%
  as.data.frame() %>%
  add_column(region = levels(data$region16)) %>%
  ggplot(aes(y = mean, x = region)) + 
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  ylab("Percent") +
  xlab("Region") +
  ggtitle("Breakdown of Study Population by Region")
```

####



